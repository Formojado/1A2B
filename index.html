<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIPHER: NEON SEQUENCE ULTRA</title>
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-pink: #ff2e63;
            --neon-green: #0f9;
            --neon-yellow: #fff01f;
            --neon-purple: #bc13fe;
            --bg-dark: #000000;
            --panel-height: 220px;
        }
        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }
        .header { 
            text-align: center; 
            padding: 15px; 
            border-bottom: 1px solid #222; 
            width: 100%;
            background: #000;
            z-index: 100;
        }
        h1 { margin: 0; font-size: 24px; letter-spacing: 4px; color: var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue); }
        
        #setup-screen { margin-top: 50px; text-align: center; background: #111; padding: 30px; border-radius: 15px; border: 1px solid var(--neon-blue); }
        
        #game-screen { 
            display: none; 
            width: 100%; 
            max-width: 450px; 
            flex-direction: column; 
            height: 100%; 
            position: relative;
        }

        .history-board { 
            flex: 1; 
            overflow-y: auto; 
            padding: 15px; 
            box-sizing: border-box;
            display: flex;
            flex-direction: column-reverse; 
            gap: 12px;
            padding-bottom: calc(var(--panel-height) + 20px); 
        }

        .row { 
            display: flex; 
            align-items: center; 
            background: rgba(255,255,255,0.05); 
            padding: 10px; 
            border-radius: 10px; 
            border: 1px solid #222; 
            justify-content: space-between;
        }

        .slots { display: flex; gap: 8px; }
        .slot {
            width: 44px; height: 44px; border-radius: 50%;
            background: #111; border: 2px dashed #444;
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .slot.over { border-color: var(--neon-blue); box-shadow: 0 0 10px var(--neon-blue); transform: scale(1.05); }

        /* ğŸŸ¢ å¼·åŒ–çƒé«”è¦–è¦ºï¼šç§»é™¤ä»»ä½•å¯èƒ½å°è‡´æ–¹å½¢çš„é‚Šè· */
        .peg {
            width: 36px; height: 36px; border-radius: 50%;
            cursor: grab; 
            transition: transform 0.1s;
            border: none; /* ç¢ºä¿æ²’æœ‰é‚Šæ¡†å¹²æ“¾ */
            display: block;
        }
        .peg:active { cursor: grabbing; }

        .c1 { background: var(--neon-blue); box-shadow: 0 0 12px var(--neon-blue); }
        .c2 { background: var(--neon-pink); box-shadow: 0 0 12px var(--neon-pink); }
        .c3 { background: var(--neon-green); box-shadow: 0 0 12px var(--neon-green); }
        .c4 { background: var(--neon-yellow); box-shadow: 0 0 12px var(--neon-yellow); }
        .c5 { background: var(--neon-purple); box-shadow: 0 0 12px var(--neon-purple); }
        .c6 { background: #ff8c00; box-shadow: 0 0 12px #ff8c00; }

        .feedback { display: grid; grid-template-columns: repeat(2, 1fr); gap: 4px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: #222; }
        .dot.exact { background: var(--neon-pink); box-shadow: 0 0 8px var(--neon-pink); }
        .dot.misplaced { background: #fff; box-shadow: 0 0 8px #fff; }

        .control-panel {
            position: absolute; bottom: 0; background: #0a0a0a; border-top: 2px solid #222;
            width: 100%; height: var(--panel-height);
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; gap: 15px; z-index: 200;
            box-shadow: 0 -15px 30px rgba(0,0,0,0.9);
        }
        .peg-source { display: flex; gap: 12px; }

        button {
            background: transparent; border: 1px solid var(--neon-blue); color: var(--neon-blue);
            padding: 10px 25px; cursor: pointer; font-weight: bold; letter-spacing: 2px;
        }
        button:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 15px var(--neon-blue); }
        button:disabled { border-color: #444; color: #444; }

        #msg { position: absolute; top: 70px; width: 100%; text-align: center; color: var(--neon-green); font-weight: bold; z-index: 50; }
    </style>
</head>
<body>

<div class="header">
    <h1>å…‰ç¢¼æ’åº CIPHER</h1>
</div>

<div id="setup-screen">
    <h3>é¸æ“‡ç ´è§£é•·åº¦</h3>
    <div style="margin: 20px 0; display:flex; gap:10px; justify-content:center;">
        <button onclick="startGame(3)">3 ä½</button>
        <button onclick="startGame(4)">4 ä½</button>
        <button onclick="startGame(5)">5 ä½</button>
    </div>
</div>

<div id="game-screen">
    <div id="msg">è«‹é–‹å§‹æ‹–æ›³é¡è‰²é€²è¡Œç ´è­¯</div>
    <div class="history-board" id="board"></div>

    <div class="control-panel">
        <div id="input-slots" class="slots"></div>
        <div class="peg-source">
            <div class="peg c1" draggable="true" data-color="1"></div>
            <div class="peg c2" draggable="true" data-color="2"></div>
            <div class="peg c3" draggable="true" data-color="3"></div>
            <div class="peg c4" draggable="true" data-color="4"></div>
            <div class="peg c5" draggable="true" data-color="5"></div>
            <div class="peg c6" draggable="true" data-color="6"></div>
        </div>
        <div>
            <button id="submit-btn" onclick="checkGuess()" disabled>æäº¤é©—è­‰</button>
            <button onclick="location.reload()" style="border-color: #444; color: #444;">æ”¾æ£„</button>
        </div>
    </div>
</div>

<script>
    let CODE_LENGTH = 4;
    let secretCode = [];
    let currentGuess = [];
    const colorClasses = ['', 'c1', 'c2', 'c3', 'c4', 'c5', 'c6'];

    function startGame(len) {
        CODE_LENGTH = len;
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'flex';
        const slotContainer = document.getElementById('input-slots');
        for(let i=0; i<len; i++) {
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.dataset.index = i;
            slot.addEventListener('dragover', e => { e.preventDefault(); slot.classList.add('over'); });
            slot.addEventListener('dragleave', () => slot.classList.remove('over'));
            slot.addEventListener('drop', handleDrop);
            slotContainer.appendChild(slot);
        }
        
        let colors = [1, 2, 3, 4, 5, 6];
        for(let i=0; i<len; i++) {
            let idx = Math.floor(Math.random() * colors.length);
            secretCode.push(colors[idx]);
            colors.splice(idx, 1);
        }
        currentGuess = Array(len).fill(0);
        
        // ğŸŸ¢ ä¿®å¾©æ‹–æ›³æ–¹å½¢æ¡†çš„é—œéµè™•ç†
        document.querySelectorAll('.peg').forEach(p => {
            p.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('colorId', p.dataset.color);
                
                // ç‚ºäº†æ¶ˆé™¤æ–¹å½¢æ¡†ï¼Œæˆ‘å€‘å¯ä»¥è®“å¿«ç…§ç¨å¾®åç§»ï¼Œæˆ–è€…åœ¨æŸäº›ç€è¦½å™¨ä¸­
                // é€éåªæ¸²æŸ“è©²å…ƒç´ æœ¬èº«ä¾†æ¸›å°‘èƒŒæ™¯æ¡†çš„é¡¯ç¾
                e.dataTransfer.effectAllowed = "move";
            });
        });
    }

    function handleDrop(e) {
        e.preventDefault();
        const slot = e.target.closest('.slot');
        slot.classList.remove('over');
        const colorId = parseInt(e.dataTransfer.getData('colorId'));
        if (colorId) {
            currentGuess[slot.dataset.index] = colorId;
            // æ”¾å…¥å¾Œä¹Ÿè¨­ç‚ºå¯æ‹–æ›³ï¼Œæ–¹ä¾¿æ›ä½ç½®æˆ–æ¸…é™¤ï¼ˆå¯é¸ï¼‰
            slot.innerHTML = `<div class="peg ${colorClasses[colorId]}"></div>`;
            document.getElementById('submit-btn').disabled = !currentGuess.every(c => c !== 0);
        }
    }

    // (å…¶é¤˜ checkGuess, renderHistory é‚è¼¯èˆ‡ä¹‹å‰ç›¸åŒï¼Œç•¥)
    function checkGuess() {
        let exact = 0, misplaced = 0;
        let tSecret = [...secretCode], tGuess = [...currentGuess];
        for(let i=0; i<CODE_LENGTH; i++) {
            if(tGuess[i] === tSecret[i]) { exact++; tSecret[i] = null; tGuess[i] = -1; }
        }
        for(let i=0; i<CODE_LENGTH; i++) {
            if(tGuess[i] !== -1 && tSecret.includes(tGuess[i])) { misplaced++; tSecret[tSecret.indexOf(tGuess[i])] = null; }
        }
        renderHistory(exact, misplaced);
        if(exact === CODE_LENGTH) {
            document.getElementById('msg').innerHTML = "ğŸŸ¢ ACCESS GRANTED: å¯†ç¢¼å·²ç ´è­¯ï¼";
            document.getElementById('submit-btn').disabled = true;
        }
    }

    function renderHistory(exact, misplaced) {
        const board = document.getElementById('board');
        const row = document.createElement('div');
        row.className = 'row';
        let html = '<div class="slots">';
        currentGuess.forEach(c => html += `<div class="slot"><div class="peg ${colorClasses[c]}"></div></div>`);
        html += '</div><div class="feedback">';
        for(let i=0; i<exact; i++) html += '<div class="dot exact"></div>';
        for(let i=0; i<misplaced; i++) html += '<div class="dot misplaced"></div>';
        for(let i=0; i<(CODE_LENGTH - exact - misplaced); i++) html += '<div class="dot"></div>';
        html += '</div>';
        row.innerHTML = html;
        board.appendChild(row);
        currentGuess = Array(CODE_LENGTH).fill(0);
        document.querySelectorAll('#input-slots .slot').forEach(s => s.innerHTML = '');
        document.getElementById('submit-btn').disabled = true;
        setTimeout(() => { board.scrollTop = board.scrollHeight; }, 50);
    }
</script>
</body>
</html>
