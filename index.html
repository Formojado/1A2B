<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIPHER: NEON SEQUENCE DRAG</title>
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-pink: #ff2e63;
            --neon-green: #0f9;
            --neon-yellow: #fff01f;
            --neon-purple: #bc13fe;
            --bg-dark: #000000;
        }
        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            min-height: 100vh;
            touch-action: manipulation;
        }
        .header { text-align: center; padding: 20px; border-bottom: 1px solid #222; width: 100%; }
        h1 { margin: 0; letter-spacing: 4px; color: var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue); }
        
        /* è¨­ç½®èœå–® */
        #setup-screen { margin-top: 50px; text-align: center; background: #111; padding: 30px; border-radius: 15px; border: 1px solid var(--neon-blue); }
        
        /* éŠæˆ²ä¸»é¢æ¿ */
        #game-screen { display: none; width: 100%; max-width: 450px; flex-direction: column; align-items: center; margin-bottom: 200px; }
        .history-board { width: 100%; margin: 20px 0; display: flex; flex-direction: column-reverse; gap: 10px; padding: 10px; box-sizing: border-box; }

        /* è¡Œæ¨£å¼ */
        .row { display: flex; align-items: center; background: rgba(20,20,20,0.8); padding: 12px; border-radius: 10px; border: 1px solid #222; justify-content: space-between; }
        .slots { display: flex; gap: 10px; }
        
        /* æ’æ§½æ¨£å¼ */
        .slot {
            width: 45px; height: 45px; border-radius: 50%;
            background: #111; border: 2px dashed #333;
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s; position: relative;
        }
        .slot.over { border-color: var(--neon-blue); box-shadow: 0 0 10px var(--neon-blue); background: #0a0a0a; }

        /* éœ“è™¹çƒæ¨£å¼ */
        .peg {
            width: 38px; height: 38px; border-radius: 50%;
            cursor: grab; transition: transform 0.2s;
            z-index: 5;
        }
        .peg:active { cursor: grabbing; }
        
        /* é¡è‰²å®šç¾© */
        .c1 { background: var(--neon-blue); box-shadow: 0 0 12px var(--neon-blue); }
        .c2 { background: var(--neon-pink); box-shadow: 0 0 12px var(--neon-pink); }
        .c3 { background: var(--neon-green); box-shadow: 0 0 12px var(--neon-green); }
        .c4 { background: var(--neon-yellow); box-shadow: 0 0 12px var(--neon-yellow); }
        .c5 { background: var(--neon-purple); box-shadow: 0 0 12px var(--neon-purple); }
        .c6 { background: #ff8c00; box-shadow: 0 0 12px #ff8c00; }

        /* åé¥‹é» */
        .feedback { display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: #222; }
        .dot.exact { background: var(--neon-pink); box-shadow: 0 0 8px var(--neon-pink); }
        .dot.misplaced { background: #fff; box-shadow: 0 0 8px #fff; }

        /* åº•éƒ¨æ‹–æ›³æ§åˆ¶å€ */
        .control-panel {
            position: fixed; bottom: 0; background: #080808; border-top: 1px solid #333;
            width: 100%; padding: 20px; display: flex; flex-direction: column; align-items: center;
            gap: 15px; box-shadow: 0 -10px 30px rgba(0,0,0,0.8);
        }
        .peg-source { display: flex; gap: 12px; }

        button {
            background: transparent; border: 1px solid var(--neon-blue); color: var(--neon-blue);
            padding: 12px 30px; cursor: pointer; font-weight: bold; letter-spacing: 2px;
            transition: 0.3s;
        }
        button:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 20px var(--neon-blue); }
        button:disabled { border-color: #444; color: #444; cursor: not-allowed; }

        #msg { height: 30px; margin: 10px; color: var(--neon-green); font-weight: bold; text-align: center; }
    </style>
</head>
<body>

<div class="header">
    <h1>å…‰ç¢¼æ’åº CIPHER</h1>
</div>

<div id="setup-screen">
    <h3>è«‹é¸æ“‡ç ´è§£é•·åº¦</h3>
    <div style="margin: 20px 0;">
        <button onclick="startGame(3)">3 ä½æ•¸</button>
        <button onclick="startGame(4)">4 ä½æ•¸ (æ¨™æº–)</button>
        <button onclick="startGame(5)">5 ä½æ•¸ (å°ˆå®¶)</button>
    </div>
    <p style="color: #666; font-size: 14px;">æ‹–æ›³è‰²å½©çƒå¡«æ»¿æ’æ§½ï¼Œé€²è¡Œé‚è¼¯ç ´è­¯</p>
</div>

<div id="game-screen">
    <div id="msg">è«‹é–‹å§‹æ‹–æ›³é¡è‰²</div>
    <div class="history-board" id="board"></div>

    <div class="control-panel">
        <div id="input-slots" class="slots">
            </div>
        <div class="peg-source">
            <div class="peg c1" draggable="true" data-color="1"></div>
            <div class="peg c2" draggable="true" data-color="2"></div>
            <div class="peg c3" draggable="true" data-color="3"></div>
            <div class="peg c4" draggable="true" data-color="4"></div>
            <div class="peg c5" draggable="true" data-color="5"></div>
            <div class="peg c6" draggable="true" data-color="6"></div>
        </div>
        <div>
            <button id="submit-btn" onclick="checkGuess()" disabled>æäº¤ç ´è§£</button>
            <button onclick="location.reload()" style="border-color: #444; color: #444;">æ”¾æ£„</button>
        </div>
    </div>
</div>

<script>
    let CODE_LENGTH = 4;
    let secretCode = [];
    let currentGuess = [];
    const colorClasses = ['', 'c1', 'c2', 'c3', 'c4', 'c5', 'c6'];

    // å•Ÿå‹•éŠæˆ²
    function startGame(len) {
        CODE_LENGTH = len;
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'flex';
        
        // ç”Ÿæˆæ’æ§½
        const slotContainer = document.getElementById('input-slots');
        for(let i=0; i<len; i++) {
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.dataset.index = i;
            slot.addEventListener('dragover', handleDragOver);
            slot.addEventListener('dragleave', handleDragLeave);
            slot.addEventListener('drop', handleDrop);
            slotContainer.appendChild(slot);
        }

        // ç”Ÿæˆå¯†ç¢¼ (ä¸é‡è¤‡)
        let colors = [1, 2, 3, 4, 5, 6];
        for(let i=0; i<len; i++) {
            let idx = Math.floor(Math.random() * colors.length);
            secretCode.push(colors[idx]);
            colors.splice(idx, 1);
        }
        currentGuess = Array(len).fill(0);
        setupDraggables();
    }

    // è¨­ç½®æ‹–æ›³
    function setupDraggables() {
        const pegs = document.querySelectorAll('.peg');
        pegs.forEach(p => {
            p.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('colorId', p.dataset.color);
            });
        });
    }

    function handleDragOver(e) { e.preventDefault(); e.target.closest('.slot').classList.add('over'); }
    function handleDragLeave(e) { e.target.closest('.slot').classList.remove('over'); }

    function handleDrop(e) {
        e.preventDefault();
        const slot = e.target.closest('.slot');
        slot.classList.remove('over');
        const colorId = parseInt(e.dataTransfer.getData('colorId'));
        const index = slot.dataset.index;

        if (colorId) {
            currentGuess[index] = colorId;
            slot.innerHTML = `<div class="peg ${colorClasses[colorId]}"></div>`;
            checkReady();
        }
    }

    function checkReady() {
        const isFull = currentGuess.every(c => c !== 0);
        document.getElementById('submit-btn').disabled = !isFull;
    }

    function checkGuess() {
        let exact = 0;
        let misplaced = 0;
        let tempSecret = [...secretCode];
        let tempGuess = [...currentGuess];

        // 1A è¨ˆç®—
        for(let i=0; i<CODE_LENGTH; i++) {
            if(tempGuess[i] === tempSecret[i]) {
                exact++;
                tempSecret[i] = null;
                tempGuess[i] = -1;
            }
        }
        // 1B è¨ˆç®—
        for(let i=0; i<CODE_LENGTH; i++) {
            if(tempGuess[i] !== -1 && tempSecret.includes(tempGuess[i])) {
                misplaced++;
                tempSecret[tempSecret.indexOf(tempGuess[i])] = null;
            }
        }

        renderHistory(exact, misplaced);

        if(exact === CODE_LENGTH) {
            document.getElementById('msg').innerHTML = "ğŸŸ¢ ACCESS GRANTED: å¯†ç¢¼å·²ç ´è­¯ï¼";
            document.getElementById('submit-btn').disabled = true;
        } else {
            document.getElementById('msg').innerText = "ğŸ”´ éŒ¯èª¤ï¼šåé¥‹å·²ç”¢ç”Ÿï¼Œè«‹ç¹¼çºŒåˆ†æ";
        }
    }

    function renderHistory(exact, misplaced) {
        const board = document.getElementById('board');
        const row = document.createElement('div');
        row.className = 'row';

        let html = '<div class="slots">';
        currentGuess.forEach(c => {
            html += `<div class="slot"><div class="peg ${colorClasses[c]}"></div></div>`;
        });
        html += '</div><div class="feedback">';
        for(let i=0; i<exact; i++) html += '<div class="dot exact"></div>';
        for(let i=0; i<misplaced; i++) html += '<div class="dot misplaced"></div>';
        for(let i=0; i<(CODE_LENGTH - exact - misplaced); i++) html += '<div class="dot"></div>';
        html += '</div>';

        row.innerHTML = html;
        board.appendChild(row);
        
        // é‡ç½®ç•¶å‰è¼¸å…¥
        currentGuess = Array(CODE_LENGTH).fill(0);
        document.querySelectorAll('#input-slots .slot').forEach(s => s.innerHTML = '');
        checkReady();
    }
</script>
</body>
</html>
