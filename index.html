<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIPHER: NEON SEQUENCE PRO</title>
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-pink: #ff2e63;
            --neon-green: #0f9;
            --neon-yellow: #fff01f;
            --neon-purple: #bc13fe;
            --bg-dark: #000000;
            --panel-height: 220px; /* å›ºå®šåº•éƒ¨é¢æ¿é«˜åº¦ */
        }
        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            height: 100vh;
            overflow: hidden; /* é˜²æ­¢æ•´é«”æ²å‹• */
        }
        .header { 
            text-align: center; 
            padding: 15px; 
            border-bottom: 1px solid #222; 
            width: 100%;
            flex-shrink: 0;
            background: #000;
            z-index: 100;
        }
        h1 { margin: 0; font-size: 24px; letter-spacing: 4px; color: var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue); }
        
        /* è¨­ç½®èœå–® */
        #setup-screen { margin-top: 50px; text-align: center; background: #111; padding: 30px; border-radius: 15px; border: 1px solid var(--neon-blue); }
        
        /* éŠæˆ²ä¸»é¢æ¿ */
        #game-screen { 
            display: none; 
            width: 100%; 
            max-width: 450px; 
            flex-direction: column; 
            height: 100%; /* æ’æ»¿è¢å¹• */
            position: relative;
        }

        /* ğŸŸ¢ æ­·å²ç´€éŒ„å€ï¼šå¢åŠ æ²å‹•èˆ‡é–“éš” */
        .history-board { 
            flex: 1; /* è‡ªå‹•ä½”æ»¿ä¸­é–“å‰©é¤˜ç©ºé–“ */
            overflow-y: auto; 
            padding: 15px; 
            box-sizing: border-box;
            display: flex;
            flex-direction: column-reverse; /* æœ€æ–°åœ¨ä¸‹ */
            gap: 12px;
            /* é—œéµï¼šåº•éƒ¨é ç•™ç©ºé–“ï¼Œé¿å…è¢«æ§åˆ¶é¢æ¿é®ä½æœ€å¾Œä¸€ç­† */
            padding-bottom: calc(var(--panel-height) + 20px); 
            scrollbar-width: thin;
            scrollbar-color: #333 transparent;
        }

        .row { 
            display: flex; 
            align-items: center; 
            background: rgba(255,255,255,0.05); 
            padding: 10px; 
            border-radius: 10px; 
            border: 1px solid #222; 
            justify-content: space-between;
            animation: fadeIn 0.4s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .slots { display: flex; gap: 8px; }
        .slot {
            width: 40px; height: 40px; border-radius: 50%;
            background: #111; border: 2px dashed #444;
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .slot.over { border-color: var(--neon-blue); box-shadow: 0 0 10px var(--neon-blue); }

        .peg {
            width: 32px; height: 32px; border-radius: 50%;
            cursor: grab; transition: transform 0.2s;
        }
        .c1 { background: var(--neon-blue); box-shadow: 0 0 12px var(--neon-blue); }
        .c2 { background: var(--neon-pink); box-shadow: 0 0 12px var(--neon-pink); }
        .c3 { background: var(--neon-green); box-shadow: 0 0 12px var(--neon-green); }
        .c4 { background: var(--neon-yellow); box-shadow: 0 0 12px var(--neon-yellow); }
        .c5 { background: var(--neon-purple); box-shadow: 0 0 12px var(--neon-purple); }
        .c6 { background: #ff8c00; box-shadow: 0 0 12px #ff8c00; }

        .feedback { display: grid; grid-template-columns: repeat(2, 1fr); gap: 4px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: #222; }
        .dot.exact { background: var(--neon-pink); box-shadow: 0 0 8px var(--neon-pink); }
        .dot.misplaced { background: #fff; box-shadow: 0 0 8px #fff; }

        /* ğŸŸ¢ åº•éƒ¨æ§åˆ¶å€ï¼šå›ºå®šé«˜åº¦ä¸”ç½®é ‚ */
        .control-panel {
            position: absolute; 
            bottom: 0; 
            background: #0a0a0a; /* ç´”é»‘ä¸é€å…‰ */
            border-top: 2px solid #222;
            width: 100%; 
            height: var(--panel-height);
            display: flex; 
            flex-direction: column; 
            align-items: center;
            justify-content: center;
            gap: 15px; 
            z-index: 200; /* ç¢ºä¿åœ¨æ­·å²ç´€éŒ„ä¸Šæ–¹ */
            box-shadow: 0 -15px 30px rgba(0,0,0,0.9);
        }
        .peg-source { display: flex; gap: 10px; }

        button {
            background: transparent; border: 1px solid var(--neon-blue); color: var(--neon-blue);
            padding: 10px 25px; cursor: pointer; font-weight: bold; letter-spacing: 2px;
        }
        button:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 15px var(--neon-blue); }
        button:disabled { border-color: #444; color: #444; }

        #msg { 
            position: absolute; 
            top: 70px; 
            width: 100%; 
            text-align: center; 
            color: var(--neon-green); 
            font-weight: bold; 
            z-index: 50;
        }
    </style>
</head>
<body>

<div class="header">
    <h1>å…‰ç¢¼æ’åº CIPHER</h1>
</div>

<div id="setup-screen">
    <h3>é¸æ“‡æŒ‘æˆ°é•·åº¦</h3>
    <div style="margin: 20px 0; display:flex; gap:10px; justify-content:center;">
        <button onclick="startGame(3)">3 ä½</button>
        <button onclick="startGame(4)">4 ä½</button>
        <button onclick="startGame(5)">5 ä½</button>
    </div>
</div>

<div id="game-screen">
    <div id="msg">è«‹é–‹å§‹æ‹–æ›³é¡è‰²é€²è¡Œç ´è­¯</div>
    <div class="history-board" id="board"></div>

    <div class="control-panel">
        <div id="input-slots" class="slots"></div>
        <div class="peg-source">
            <div class="peg c1" draggable="true" data-color="1"></div>
            <div class="peg c2" draggable="true" data-color="2"></div>
            <div class="peg c3" draggable="true" data-color="3"></div>
            <div class="peg c4" draggable="true" data-color="4"></div>
            <div class="peg c5" draggable="true" data-color="5"></div>
            <div class="peg c6" draggable="true" data-color="6"></div>
        </div>
        <div>
            <button id="submit-btn" onclick="checkGuess()" disabled>æäº¤é©—è­‰</button>
            <button onclick="location.reload()" style="border-color: #444; color: #444;">æ”¾æ£„</button>
        </div>
    </div>
</div>

<script>
    let CODE_LENGTH = 4;
    let secretCode = [];
    let currentGuess = [];
    const colorClasses = ['', 'c1', 'c2', 'c3', 'c4', 'c5', 'c6'];

    function startGame(len) {
        CODE_LENGTH = len;
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'flex';
        const slotContainer = document.getElementById('input-slots');
        for(let i=0; i<len; i++) {
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.dataset.index = i;
            slot.addEventListener('dragover', e => { e.preventDefault(); slot.classList.add('over'); });
            slot.addEventListener('dragleave', () => slot.classList.remove('over'));
            slot.addEventListener('drop', handleDrop);
            slotContainer.appendChild(slot);
        }
        let colors = [1, 2, 3, 4, 5, 6];
        for(let i=0; i<len; i++) {
            let idx = Math.floor(Math.random() * colors.length);
            secretCode.push(colors[idx]);
            colors.splice(idx, 1);
        }
        currentGuess = Array(len).fill(0);
        document.querySelectorAll('.peg').forEach(p => {
            p.addEventListener('dragstart', (e) => e.dataTransfer.setData('colorId', p.dataset.color));
        });
    }

    function handleDrop(e) {
        e.preventDefault();
        const slot = e.target.closest('.slot');
        slot.classList.remove('over');
        const colorId = parseInt(e.dataTransfer.getData('colorId'));
        if (colorId) {
            currentGuess[slot.dataset.index] = colorId;
            slot.innerHTML = `<div class="peg ${colorClasses[colorId]}"></div>`;
            document.getElementById('submit-btn').disabled = !currentGuess.every(c => c !== 0);
        }
    }

    function checkGuess() {
        let exact = 0, misplaced = 0;
        let tSecret = [...secretCode], tGuess = [...currentGuess];
        for(let i=0; i<CODE_LENGTH; i++) {
            if(tGuess[i] === tSecret[i]) { exact++; tSecret[i] = null; tGuess[i] = -1; }
        }
        for(let i=0; i<CODE_LENGTH; i++) {
            if(tGuess[i] !== -1 && tSecret.includes(tGuess[i])) { misplaced++; tSecret[tSecret.indexOf(tGuess[i])] = null; }
        }
        renderHistory(exact, misplaced);
        if(exact === CODE_LENGTH) {
            document.getElementById('msg').innerHTML = "ğŸŸ¢ ACCESS GRANTED: å¯†ç¢¼å·²ç ´è­¯ï¼";
            document.getElementById('submit-btn').disabled = true;
        }
    }

    function renderHistory(exact, misplaced) {
        const board = document.getElementById('board');
        const row = document.createElement('div');
        row.className = 'row';
        let html = '<div class="slots">';
        currentGuess.forEach(c => html += `<div class="slot"><div class="peg ${colorClasses[c]}"></div></div>`);
        html += '</div><div class="feedback">';
        for(let i=0; i<exact; i++) html += '<div class="dot exact"></div>';
        for(let i=0; i<misplaced; i++) html += '<div class="dot misplaced"></div>';
        for(let i=0; i<(CODE_LENGTH - exact - misplaced); i++) html += '<div class="dot"></div>';
        html += '</div>';
        row.innerHTML = html;
        board.appendChild(row);
        currentGuess = Array(CODE_LENGTH).fill(0);
        document.querySelectorAll('#input-slots .slot').forEach(s => s.innerHTML = '');
        document.getElementById('submit-btn').disabled = true;
        // è‡ªå‹•æ»¾å‹•åˆ°æœ€ä¸‹æ–¹
        setTimeout(() => { board.scrollTop = board.scrollHeight; }, 50);
    }
</script>
</body>
</html>
